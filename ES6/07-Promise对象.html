<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<script>
    /*
    * 定义:Promise是异步编程的一种解决方案，比一般的传统的解决方案(回调函数事件)强大合理
    * 简单的说呢，Promise就是一个容器，里面保存着某个未来才会结束的事件(一般的是一个异步操作)结果。
    * 从语法上讲 Promise是一个对象，可以获取异步操作的消息，Promise提供统一的API，
    * 各种异步操作都可以使用同样的方法进行处理
    *
    *
    * 特点：
    * (1)promise对象的状态不受外界的影响，promise对象代表一个异步操作，有三种状态：
    * Pending(进行中)、Resolved(已完成)、Rejected(已失败) 这里只有异步操作
    * (2)一旦状态改变，就不会改变，在任何时候都可以得到这个结果。Promise对象的状态改变，
    * 从pending变为Resolved和Pending变为Rejected,一旦状态确立，就不会改变了
    *
    *
    * 有了Promise对象，可以将异步操作以同步操作的流程表达出来，避免层层回调，避免回调地狱
    * 另外，Promise 对象提供统一的接口，使控制异步操作更加容易
    *
    *
    * 缺点：
    * 1.Promise是无法取消的，一旦建立它就会执行，无法中途取消。
    * 2.如果不设置回调函数，promise内部抛出的错误，不会反应到外部。
    * 3.当处于pending状态时，无法得知目前进展到哪一个阶段（是刚开始还是快要完成了）
    *
    * 解决办法：
    * 如果某些事件不断的反复发生，使用stream模式要比promise更好
    * */

//    Promise实例
    var promise = new Promise(function(resolve,reject){
        if(/*异步操作成功*/){
            resolve(value);
        }else {
            reject(error)
        }
    })
    /*
    * 如上述实例中：
    * Promise构造函数接受一个函数作为参数，分别为resolve和reject
    *
    * reslove的作用是，将Promise对象的状态从'未完成'变为'成功'(from Pending to Resolved)
    * reject的作用是，将Promise对象的状态从'未完成'变成'失败'(from Pending to Rejectd)
    *
    *
    * promise实例生效后，可以用then方法指定Resolved状态和Reject状态的回调函数
    *
    * */


    promise.then(function (data) {
//        success
    },function (error) {
//        error
    })


//  使用promise异步加载图片的例子
    function loadImageAsync(url) {
        return new Promise(function (resolve,reject) {
            var img = new Image();

            img.onload = function () {
                resolve(img)
            };

            img.onerror = function () {
                reject(new Error('Could not load img at' + url))
            };

            img.src = url;
        })
    }

//    使用promise实现Ajax操作
    var getJSON = function (url) {
        var promise = new Promise(function (resolve,reject) {
            var client = new XMLHttpRequest();
            client.open('GET',url);
            client.onreadystatechange = function () {
                if(this.readyState !== 4){
                    return;
                }
                if(this.status === 200){
                    resolve(this.response);
                }else{
                    reject(new Error(this.statusText))
                }
            };
            client.send()
        })
        return promise;
    }

    getJSON('/name.json').then(function (json) {
        console.log(json);
    },function (error) {
        console.log('出错了，老铁');``
    })
</script>
</body>
</html>